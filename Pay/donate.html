<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Donation</title>
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
  <link rel="stylesheet" href="donate.css">
</head>
<body>
  <section>
    <div class="back-button">
      <a href="https://musaflacko.github.io/assignment-3/Home%20Page/home.html">
        <img src="Back Button.jpg" alt="" width="10%">
      </a>
    </div>

    <header>
      <h2>Help Us!</h2>
    </header>

    <main>
      <div class="container-card">
        <div class="text-center">
          <div class="card" style="width: 100%;">
            <lottie-player class="card-img-top" alt="..." src="https://assets5.lottiefiles.com/packages/lf20_wdXBRc.json"  background="transparent"  speed="1"  style="width: 345px; height: 300px;"  loop  autoplay></lottie-player>
            <h5 class="card-title">Help Families in Asia</h5>
            <div class="card-body">
              <p class="card-text">In Asia, there are families that are living in extreme poverty. Escalating effects of the Covid-19 pandemic are impacting these families. Help them fight against the Covid-19 virus by protecting them. Smart Mask helps to create a better protection against the Covid-19 virus. Thus, donate now and provide protection for them. Together, we will be able to fight against this pandemic!</p>
            </div>
          </div>
        </div>
      </div>

      <div class="progress">
        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="width: 50%">50%</div>
      </div>

      <div class="details">
        <div class="button">
          <img src="Target Icon.png" alt="" width="25%">
          <br>
          Target: $1000
        </div>
        <div class="button">
          <img src="Money Icon.png" alt="" width="25%">
          <br>
          Waiting: $500
        </div>
      </div>

      <div id="checkout">
        <div class="text-center">
          <button type="button" class="btn btn-light" id="buyButton">Donate Now</button>
        </div>
      </div>
    </main>
  </section>

</body>
  
<script>
  const allowedCardNetworks = ["AMEX", "DISCOVER", "INTERAC", "JCB", "MASTERCARD", "VISA"];
  const allowedCardAuthMethods = ["PAN_ONLY", "CRYPTOGRAM_3DS"];
  if (window.PaymentRequest) {
    const request = createPaymentRequest();
  
    request.canMakePayment()
        .then(function(result) {
          if (result) {
            // Display PaymentRequest dialog on interaction with the existing checkout button
            document.getElementById('buyButton')
                .addEventListener('click', onBuyClicked);
          }
        })
        .catch(function(err) {
          showErrorForDebugging(
              'canMakePayment() error! ' + err.name + ' error: ' + err.message);
        });
  } else {
    showErrorForDebugging('PaymentRequest API not available.');
  }
  
  /**
   * Show a PaymentRequest dialog after a user clicks the checkout button
   */
  function onBuyClicked() {
    createPaymentRequest()
        .show()
        .then(function(response) {
          // Dismiss payment dialog.
          response.complete('success');
          handlePaymentResponse(response);
        })
        .catch(function(err) {
          showErrorForDebugging(
              alert('Transaction Canceled, Try Again!')
              );
        });
  }
  
  /**
   * Define your unique Google Pay API configuration
   *
   * @returns {object} data attribute suitable for PaymentMethodData
   */
  function getGooglePaymentsConfiguration() {
    return {
      environment: 'TEST',
      apiVersion: 2,
      apiVersionMinor: 0,
      merchantInfo: {
        // A merchant ID is available after approval by Google.
        // 'merchantId':'12345678901234567890',
        merchantName: 'Example Merchant'
      },
      allowedPaymentMethods: [{
        type: 'CARD',
        parameters: {
          allowedAuthMethods: allowedCardAuthMethods,
          allowedCardNetworks: allowedCardNetworks
        },
        tokenizationSpecification: {
          type: 'PAYMENT_GATEWAY',
          // Check with your payment gateway on the parameters to pass.
          // @see {@link https://developers.google.com/pay/api/web/reference/request-objects#gateway}
          parameters: {
            'gateway': 'example',
            'gatewayMerchantId': 'exampleGatewayMerchantId'
          }
        }
      }]
    };
  }
  
  /**
   * Create a PaymentRequest
   *
   * @returns {PaymentRequest}
   */
  function createPaymentRequest() {
    // Add support for the Google Pay API.
    const methodData = [{
      supportedMethods: 'https://google.com/pay',
      data: getGooglePaymentsConfiguration()
    }];
    // Add other supported payment methods.
    methodData.push({
      supportedMethods: 'basic-card',
      data: {
        supportedNetworks:
            Array.from(allowedCardNetworks, (network) => network.toLowerCase())
      }
    });
  
    const details = {
      total: {label: 'Smart Mask Donation', amount: {currency: 'USD', value: '20.00'}}
    };
  
    const options = {
      requestPayerEmail: true,
      requestPayerName: true
    };
  
    return new PaymentRequest(methodData, details, options);
  }
  
  /**
   * Process a PaymentResponse
   *
   * @param {PaymentResponse} response returned when a user approves the payment request
   */
  
  function handlePaymentResponse(response) {
    const formattedResponse = document.createElement('pre');
    formattedResponse.appendChild(
        document.createTextNode(JSON.stringify(response.toJSON(), null, 2)));
    document.getElementById('checkout')
        .insertAdjacentElement('afterend', formattedResponse);
        location.href = "https://musaflacko.github.io/assignment-3/Thank%20You/thanks.html";
  }
  
  /**
   * Display an error message for debugging
   *
   * @param {string} text message to display
   */
  function showErrorForDebugging(text) {
    const errorDisplay = document.createElement('code');
  }
  </script>
  </html>